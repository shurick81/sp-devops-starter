{
    "builders": [
        {
            "type": "virtualbox-iso",
            "iso_checksum": "5b5e08c490ad16b59b1d9fab0def883a",
            "iso_checksum_type": "md5",
            "iso_url": "https://download.microsoft.com/download/6/2/A/62A76ABB-9990-4EFC-A4FE-C7D698DAEB96/9600.17050.WINBLUE_REFRESH.140317-1640_X64FRE_SERVER_EVAL_EN-US-IR3_SSS_X64FREE_EN-US_DV9.ISO",
            "floppy_files": [
                "win2012r2/Autounattend.xml",
                "winrm.ps1"
            ],
            "guest_additions_mode": "attach",
            "guest_os_type": "Windows2012_64",
            "headless": true,
            "http_directory": "http",
            "shutdown_command": "powershell -File c:\\tmp\\sysprep.ps1",
            "vboxmanage": [
                [ "modifyvm", "{{.Name}}", "--memory", "4096" ],
                [ "modifyvm", "{{.Name}}", "--cpus", "8" ]
            ],
            "communicator": "winrm",
            "winrm_username": "administrator",
            "winrm_password": "Fractalsol",
            "winrm_timeout": "2h"
        },
        {
            "type": "hyperv-iso",
            "iso_checksum": "5b5e08c490ad16b59b1d9fab0def883a",
            "iso_checksum_type": "md5",
            "iso_url": "https://download.microsoft.com/download/6/2/A/62A76ABB-9990-4EFC-A4FE-C7D698DAEB96/9600.17050.WINBLUE_REFRESH.140317-1640_X64FRE_SERVER_EVAL_EN-US-IR3_SSS_X64FREE_EN-US_DV9.ISO",
            "floppy_files": [
                "win2012r2/Autounattend.xml",
                "winrm.ps1"
            ],
            "http_directory": "http",
            "shutdown_command": "powershell -File c:\\tmp\\sysprep.ps1",
            "ram_size": 4096,
            "cpu": 8,
            "switch_name": "Default Switch",
            "communicator": "winrm",
            "winrm_username": "administrator",
            "winrm_password": "Fractalsol",
            "winrm_timeout": "2h"
        }
    ],
    "provisioners": [
        {
            "type": "powershell",
            "script": "VirtualBox/installadditions.ps1",
            "only": ["virtualbox-iso"]
        },
        {
            "type": "powershell",
            "script": "rdpenable.ps1",
            "only": ["virtualbox-iso","hyperv-iso"]
        },
        { "type": "powershell", "script": "wmf5.ps1",
            "elevated_user": "administrator", "elevated_password": "Fractalsol"
        },
        {
            "type": "powershell",
            "inline": "Write-Host 'Canary script just for pause after wmf5 installation'",
            "pause_before": "10m"
        },
        { "type": "powershell", "script": "PackageManagementProviderResource.ps1" },
        { "type": "powershell", "script": "basepsmodules.ps1" },
        { "type": "powershell", "script": "sqlpsmodules.ps1" },
        { "type": "powershell", "script": "sppsmodules.ps1" },
        { "type": "powershell", "script": "domainclientpsmodules.ps1" },
        { "type": "powershell", "script": "sqlmedia.ps1" },
        {
            "type": "powershell",
            "script": "sqlprebin-local.ps1",
            "only": ["virtualbox-iso", "hyperv-iso"]
        },
        { "type": "windows-restart" },
        { "type": "powershell", "script": "sqlbin.ps1" },
        { "type": "powershell", "script": "sqlmediaclean.ps1" },
        { "type": "powershell", "script": "spprebin-1.ps1" },
        { "type": "windows-restart" },
        { "type": "powershell", "script": "spprebin-2.ps1" },
        { "type": "powershell", "script": "spmedia.ps1" },
        { "type": "powershell", "script": "spprebin-3.ps1" },
        { "type": "windows-restart" },
        { "type": "powershell", "script": "spbin.ps1" },
        { "type": "powershell", "script": "spmediaclean.ps1" },
        { "type": "powershell", "script": "xcredserver.ps1" },
        { "type": "powershell", "script": "waitforcpucalm.ps1" },
        {
            "type": "file",
            "source": "sysprep.ps1",
            "destination": "c:\\tmp\\sysprep.ps1",
            "only": ["virtualbox-iso","hyperv-iso"]
        },
        {
            "type": "file",
            "source": "autounattend_sysprep.xml",
            "destination": "c:\\tmp\\autounattend_sysprep.xml",
            "only": ["virtualbox-iso","hyperv-iso"]
        }
    ],
    "post-processors": [
        {
          "type": "vagrant",
          "output": "sp-win2012r2-db-web.box"
        }
    ]
}